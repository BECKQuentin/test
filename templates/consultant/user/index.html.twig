{% extends 'base.html.twig' %}

{% block title 'Utilisateurs' %}

{% block body %}

    <div class="content_box">

        {{ topTabs([
            { 'url': 'consultant_add_contractor', 'svgs': ['plus', 'helmet-safety'], 'title': 'Créer un donneur d\'ordre', 'role': 'ROLE_CONSULTANT' },
            { 'url': 'consultant_add_installer', 'svgs': ['plus', 'screwdriver-wrench'], 'title': 'Créer un installateur', 'role': 'ROLE_CONSULTANT' },
            { 'url': 'admin_add_consultant', 'svgs': ['plus', 'chalkboard-user'], 'title': 'Créer un consultant', 'role': 'ROLE_ADMIN' },
        ]) }}


        <h2>Liste des utilisateurs</h2>

        <div class="content_box_element">
                {{ form_start(searchForm) }}
                <div class="row">
{#                    {% if is_granted('ROLE_ADMIN') %}#}
{#                        <div class="col-6">#}
{#                            {{ form_row(searchForm.createdBy) }}#}
{#                        </div>#}
{#                    {% endif %}#}
                    <div class="col-12 col-md-6 position-relative">
                        <div class="position-absolute top-0 end-0 me-4" title="Ce champ recherche parmis : Email, Prénom, Nom, Code Postal, Ville, Numéro Siret">{{ 'circle-info'|svg }}</div>
                        {{ form_row(searchForm.q) }}
                    </div>
{#                    <div class="col-6 col-md-2">#}
{#                        {{ form_row(searchForm.numSiret) }}#}
{#                    </div>#}
                    <div class="col-6 col-md-2 d-flex align-items-center">
                        {{ form_row(searchForm.submit) }}
                    </div>
                </div>
                {{ form_end(searchForm) }}

            <hr>

            {% if users|length is not same as 0 %}
                <div class="table-responsive">
                    <span>{{ users|length }} utilisateurs trouvés</span>
                    <table class="table">
                        <thead>
                        <tr>
                            <th scope="col">Crée</th>
                            <th scope="col">Roles</th>
                            <th scope="col">Nom</th>
                            <th scope="col">Infos</th>
                            <th scope="col">Dossiers</th>
                            <th scope="col">Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for user in users %}
                            <tr>
                                <td>{{ user.createdAt|format_datetime('short', 'none', locale="fr") }}</td>
                                <td>{{ displayRole(user) }}</td>
                                <td>
                                    <div><a href="{{ path('user_show', {id: user.id}) }}" class="link_underline mb-1"><b>{{ user.fullName }}</b></a></div>
                                    <div><a href="mailto:{{ user.email }}" class="link_underline">{{ user.email }}</a></div>
                                    {% if user.phone is not null %}
                                        <div class="d-flex align-items-center">
                                            <span class="svg-primary me-1">{{ 'phone'|svg }}</span><a href="tel:{{ user.phone }}" class="link_underline">{{ user.phone }}</a>
                                        </div>
                                    {% endif %}
                                    {% if user.mobile is not null %}
                                        <div class="d-flex align-items-center">
                                            <span class="svg-primary me-1">{{ 'mobile'|svg }}</span><a href="tel:{{ user.mobile }}" class="link_underline">{{ user.mobile }}</a>
                                        </div>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if user.installer is not same as null %}
                                        <div class="d-flex flex-column">
                                            <div class="d-flex">
                                                <p>Contrat cadre : </p><b>{{ user.installer.numContratCadre }}</b>
                                            </div>
                                            <div class="d-flex">
                                                <p>Raison Social : </p><b>{{ user.installer.socialReason }}</b>
                                            </div>
                                            <div class="d-flex">
                                                <p>Siret : </p><b>{{ user.installer.numSiret }}</b>
                                            </div>
                                            <div class="d-flex flex-column">
                                                <div class="d-flex flex-column">
                                                    <b>{{ user.installer.address }}</b>
                                                    <b>{{ user.installer.postalCode }} {{ user.installer.city }}</b>
                                                </div>
                                            </div>
                                        </div>
                                    {% elseif user.contractor is not same as null %}
                                        <div class="d-flex flex-column">
                                            <div class="d-flex">
                                                <p>Contrat cadre : </p><b>{{ user.contractor.numContratCadre }}</b>
                                            </div>
                                            <div class="d-flex">
                                                <p>Raison Social : </p><b>{{ user.contractor.socialReason }}</b>
                                            </div>
                                            <div class="d-flex">
                                                <p>Siret : </p><b>{{ user.contractor.numSiret }}</b>
                                            </div>
                                            <div class="d-flex flex-column">
                                                <div class="d-flex flex-column">
                                                    <b>{{ user.contractor.address }}</b>
                                                    <b>{{ user.contractor.postalCode }} {{ user.contractor.city }}</b>
                                                </div>
                                            </div>
                                        </div>
                                    {% endif %}

                                </td>
                                <td>
                                    <div class="d-flex flex-column">
                                        <div class="badge_elan badge_light_green">5 dossier en cours</div>
                                        <div class="badge_elan badge_success">5 dossier terminé</div>
                                        <div class="badge_elan badge_error">5 dossier refusé</div>
                                    </div>
                                </td>
                                <td>
                                    <a href="" title="Voir ses dossiers" class="btn btn-elan-neumorphism">{{ 'folder-open'|svg }}</a>
                                    <a href="{{ path('user_show', {id: user.id}) }}" title="Voir le profil" class="btn btn-elan-neumorphism">{{ 'eye'|svg }}</a>
                                    {#                        <a href="{{ path('spiritual_master_show_user', {id: user.id}) }}" class="btn btn-primary">{{ 'app.show'|trans }}</a>#}
                                    {#                        <a href="{{ path('spiritual_master_edit_user', {id: user.id}) }}" class="btn btn-secondary ms-1">{{ 'app.edit'|trans }}</a>#}
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>

                <div class="my-2">
                    {{ knp_pagination_render(users) }}
                </div>
            {% else %}
                <div class="d-flex flex-column justify-content-center align-items-center">
                    <img src="{{ asset('assets/img/default/no-energy.png') }}" alt="No energy">
                    <h4>Aucune données trouvées</h4>
                </div>
            {% endif %}


        </div>

    </div>




{% endblock %}